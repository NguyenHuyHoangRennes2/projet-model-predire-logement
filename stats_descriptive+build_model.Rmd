---
title: "Titre du projet"  
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    highlight: kate
    number_sections: FALSE
    df_print: paged
---

```{r setup, include=FALSE , echo=FALSE}
knitr::opts_chunk$set(cache = F,
                        message = FALSE,   # ↩ cache les messages (library, etc.)
                         warning = FALSE) 
options("install.lock"=FALSE) #Désactiver le verrouillage d’installation des packages
setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) ## configure le chemin du dossier automatiquement
```

**NOM - Prénom**

[**Master 1 MAS - Université de Rennes**](https://eco.univ-rennes.fr/master-mathematiques-appliquees-statistique)

**ou**

[**Master 1 MAS - Université Rennes 2**](https://formations.univ-rennes2.fr/fr/formations/master-37/master-mention-mathematiques-appliquees-statistique-parcours-sciences-des-donnees-intelligence-artificielle-JFTJBMKM.html)

[Pensez à numéroter vos tables et graphiques, cela vous permet de faire des rappels dans votre texte. Attention également au titre et à la bonne définition des axes. Chaque graphique est commenté, il est parfois préférable de les regrouper au sein d'une même fenêtre pour que le rapport soit plus agréable à lire. N'hésitez pas à faire des sélections de graphiques intéressants plutôt que de les présenter d'une manière mécanique. Il ne faut pas utiliser le code de vos variables dans vos commentaires mais revenir sur leur signification. ]{style="color:red;"}

---
title: "Analyse des déterminants du loyer à Rennes"
author: "Nom Prénom"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

# 1. Introduction

L’accès au logement constitue aujourd’hui un enjeu socio-économique majeur en France. 
Dans un contexte de pression croissante sur le marché locatif, notamment dans les villes 
à forte attractivité universitaire comme Rennes, les ménages sont confrontés à une 
hausse soutenue des loyers. Comprendre les facteurs qui influencent le prix des logements 
devient alors essentiel pour analyser les disparités territoriales et éclairer les décisions 
des acteurs publics.

Dans ce projet, nous cherchons à analyser empiriquement les **déterminants du loyer tout 
compris** des logements situés à Rennes, en utilisant des données collectées automatiquement 
par web scraping sur le site *Ouest-France Immo*. L’étude se concentre sur les logements qui sont répartis dans quatre grands secteurs 
de Rennes : **Centre**, **Ouest**, **Nord-Est** et **Nord-Ouest**.

##  1.1 Contexte et problématique

Le marché rennais est particulièrement dynamique en raison de sa croissance démographique, 
de son attractivité étudiante et d’une offre locative limitée. Dès lors, une question 
centrale se pose :

> **Quels facteurs structurels expliquent les variations de loyer à Rennes ?**

Cela conduit à examiner l’effet de la surface, du nombre de pièces, des charges, de la 
performance énergétique et de la localisation géographique.

## 1.2 Motivation et intérêt du sujet

Ce travail présente plusieurs intérêts :
- illustrer une application réelle de la **régression linéaire** à partir de données collectées soi-même ;
- analyser les **disparités intra-urbaines** du marché locatif rennais ;
- évaluer l’influence de caractéristiques structurelles ou environnementales du logement ;
- proposer un exemple complet de démarche allant de la collecte de données au modèle final.

## 1.3 Questions de recherche et hypothèses

Les questions principales sont :

1. La surface influence-t-elle fortement le montant du loyer ?
2. Les charges intégrées modifient-elles significativement le niveau du loyer tout compris ?
3. La performance énergétique joue-t-elle un rôle dans la détermination du prix ?
4. Le quartier exerce-t-il un effet propre sur les niveaux de loyer ?

Les hypothèses qui en découlent sont :

- **H1 :** une surface plus élevée entraîne un loyer plus élevé 

- **H2 :** des charges plus importantes augmentent le loyer tout compris

- **H3 :** une meilleure performance énergétique est associée à un loyer supérieur 

- **H4 :** les logements du Centre sont plus chers que ceux des autres quartiers.


## 1.4 Objectifs du mémoire

Les objectifs du projet sont :
- modéliser et expliquer le loyer mensuel tout compris ;
- identifier les déterminants les plus significatifs ;
- analyser les différences selon les quartiers rennais ;
- proposer une interprétation économétrique rigoureuse.

## 1.5 Plan du document

Ce mémoire est structuré comme suit :

- **Section 1 : Introduction**
- **Section 2 : Cadre méthodologique**
- **Section 3 : Analyse descriptive des données**
- **Section 4 : Estimation et interprétation du modèle**
- **Section 5 : Conclusion**

---

# 2. Cadre méthodologique

Cette section présente le modèle économétrique utilisé et les choix méthodologiques qui 
guident l’estimation.

## 2.1 Choix méthodologiques : régression linéaire et MCO

Le modèle retenu est une **régression linéaire multiple**, estimée à l’aide de la 
méthode des **Moindres Carrés Ordinaires (MCO)**. Cette approche permet d’étudier 
comment une variable quantitative , ici le loyer tout compris dépend de plusieurs 
caractéristiques propres au logement.

La méthode MCO consiste à minimiser la somme des carrés des écarts entre les valeurs 
observées et celles prédites par le modèle. Cette méthode est privilégiée pour sa 
simplicité, son interprétabilité et les propriétés de ses estimateurs.

## 2.2 Formulation du modèle

La variable expliquée est le **loyer mensuel tout compris** (en euros).

Les variables explicatives sont :

- la **surface** du logement (m²),
- les **charges comprises** (euros),
- le **nombre de pièces**,
- la **classe énergétique** (A, B, C, …),
- la **consommation énergétique annuelle** (kWh/an),
- les **émissions de CO₂** (kg/an),
- le **quartier** (Centre, Ouest, Nord-Est, Nord-Ouest).

Le modèle général s’écrit :

\[
\text{Loyer}_i = \beta_0 +
\beta_1 \text{Surface}_i +
\beta_2 \text{Charges}_i +
\beta_3 \text{Pièces}_i +
\beta_4 \text{ClasseÉnergie}_i +
\beta_5 \text{Consommation}_i +
\beta_6 \text{ÉmissionsCO2}_i +
\sum_q \gamma_q \text{Quartier}_{qi} +
\varepsilon_i
\]

où :
- \( \beta_0 \) est la constante

- \( \beta_j \) mesure l’effet marginal de chaque caractéristique

- \( \gamma_q \) capture l’effet des quartiers par rapport à un quartier de référence

- \( \varepsilon_i \) est le terme d’erreur


## 2.3 Justification des choix techniques

Plusieurs éléments motivent ce cadre :

- La régression linéaire est un outil adapté pour analyser les facteurs influençant une variable économique.
- La méthode MCO fournit des estimateurs robustes et facilement interprétables.
- L’utilisation de **variables indicatrices** pour les quartiers permet de mettre en évidence les différences géographiques de prix.
- L’intégration des variables énergétiques répond aux enjeux actuels de performance environnementale.
- Le modèle permet de mesurer l’effet propre de chaque variable tout en contrôlant les autres.

---


# 3. Analyse des données

## 3.1 Cadre des données

Les données proviennent du site **Ouest-France Immo**, collectées à l’aide d’un script de 
web scraping. Elles décrivent des logements mis en location dans la **ville de Rennes**, 
.

L’étude porte sur **quatre secteurs géographiques** :

- Quartiers Centre 

- Quartiers Ouest

- Quartiers Nord-Est 

- Quartiers Nord-Ouest


Chaque ligne du jeu de données correspond à **une annonce unique**.  
Les variables collectées décrivent :

- Les caractéristiques du logement (surface, nombre de pièces, charges)

- Sa performance énergétique (classe, consommation, émissions)

- Sa localisation.

### a) Importation des données
```{r, echo=FALSE}
library("tidyverse")
annonces <- read.csv("annonces.csv" , sep=",")
annonces <- annonces[, c("Loyer", "Surface.habitable", "Dont.charges",
                         "Pièces" , "Pièce", "label_eco", "kWh.m...an",
                         "kgCO2.m...an", "Quartiers")]

annonces <- annonces %>%
  rename(
    Loyer_TTC = Loyer,
    Surface   = `Surface.habitable`,
    Charges   = `Dont.charges`,
    kWh       =  kWh.m...an,
    kgCO2     = `kgCO2.m...an`
  )

annonces$label_eco <- factor(annonces$label_eco)
head(annonces,5)
```

### b) Description des variables
```{r, echo=FALSE}
knitr::kable(
  data.frame(
    `Code de la série` = c("prix_TCC", "Surface", "Charges", "Pieces", 
                           "label_eco", "kWh", "kgCO2", "Quartiers"),
    `Définition` = c("Loyer mensuel tout compris",
                     "Surface habitable du logement",
                     "Montant des charges mensuelles",
                     "Nombre de pièces du logement",
                     "Classe énergétique du logement",
                     "Consommation énergétique annuelle",
                     "Émissions annuelles de CO2",
                     "Secteur géographique du logement"),
    `Unité` = c("Euros", "m²", "Euros", "Nombre", 
                "Catégorie (A–G)", "kWh/an", "kg/an", "Nom du quartier"),
    `Source` = rep("Ouest-France Immo (web scraping)", 8)
  ),
  caption = "Tableau 1 : Description des variables"
)


```


## 3.2  Prétraitement et nettoyage des données

Avant de procéder aux analyses descriptives et économétriques, il a été nécessaire de réaliser un travail approfondi de préparation des données issues du web scraping. Comme souvent avec des données collectées directement sur un site d’annonces, plusieurs problèmes se présentent : valeurs manquantes, incohérences, doublons, hétérogénéité dans les formats ou dans les catégories. Cette section présente de manière structurée l’ensemble des opérations réalisées pour obtenir un jeu de données exploitable.


### a)Sélection et renommage des variables

Dans un premier temps, seules les variables pertinentes pour l’étude ont été conservées.  
Les colonnes correspondant "Loyer", "Surface.habitable", "Dont.charges","Pièces" , "Pièce", "label_eco", "kWh.m...an","kgCO2.m...an", "Quartiers" ont été extraites.  
Les noms ont également été standardisés pour faciliter leur manipulation (par exemple : renommer *Surface habitable* en *Surface*, *Dont charges* en *Charges*, etc.).


### b) Corriger les valeurs manquantes et modéliser les niveaux

#### b.1 Modéliser les niveaux
**Découper le Loyer TTC en facteur **

```{r}
seuil <-  quantile(annonces$Loyer_TTC ,probs = seq(0, 1, 0.25))
annonces$Loyer_Groupe <- cut(annonces$Loyer_TTC , breaks = seuil , include.lowest = TRUE)

```
**Exclusion des annonces non classées énergétiquement** : les logements portant la mention *NC* (Non Classé) ont été retirés.

  **Avant traitement**
```{r}
table(annonces$label_eco)
```

- **Regroupement de certaines catégories énergétiques** : les labels *G*, *A* , *B* et *C* ont été regroupés dans une catégorie commune (*C+*) et les labels  *E* et *F* ont été regroupés dans une catégorie commune (*E-*) pour éviter des classes trop peu représentées.
```{r,,echo=FALSE}
annonces <-annonces %>%filter(label_eco !="NC") # levels il reste toujours meme si le nombre d'effective =0
annonces$label_eco <- droplevels(annonces$label_eco)
levels(annonces$label_eco)[levels(annonces$label_eco) %in% c("G","A","B" ,"C")] <-"C+"
levels(annonces$label_eco)[levels(annonces$label_eco) %in% c("E","F")] <-"E-"
levels(annonces$label_eco)[] <-levels(annonces$label_eco)[1:3]
levels(annonces$label_eco)
idx <- which(annonces$label_eco == "C+")
annonces$label_eco <- as.numeric(annonces$label_eco)
annonces$label_eco[idx]


```
  
  **Apres traitement**
  
```{r,echo=FALSE}
table(annonces$label_eco)
```
#### b.2 One Hot Encoding la variables Quartiers


      
```{r}
#install.packages("fastDummies")
library(fastDummies)
annonces <- annonces%>% mutate(Quartiers = sub("Quartiers " , "" , Quartiers))
annonces <- annonces%>% mutate(Quartiers = sub("-" , "_" , Quartiers))
annonces$Quartiers <- factor(annonces$Quartiers)
annonces <- dummy_cols(annonces, select_columns = "Quartiers")


```

#### b.3 Correction des valeurs manquante
- **Correction des pièces manquantes** : Le jeu de données contient deux variables liées au nombre de pièces du logement :

- **Pièces** : prend une valeur manquante (`NA`) ou bien un nombre de pièces **strictement supérieur à 1** ;
- **Piece** : variable binaire prenant la valeur `1` ou `NA`, et renseignée uniquement lorsque `Pièces` est manquante. Finalement, nous avons remplacé toutes les valeurs manquantes par 1 (1 pièce).
```{r ,echo=F}
library(tidyverse)
annonces <- annonces %>% mutate(Pièces = ifelse(is.na(Pièces) , 1 ,Pièces))
annonces <- dplyr::select(annonces, -Pièce)
```

  
- **Imputation énergétique** : les valeurs manquantes concernant la consommation en kWh et les émissions de CO₂ ont été remplacées par la moyenne calculée au sein de chaque classe énergétique.  
  Cela permet une imputation cohérente avec le profil énergétique du logement.

Ces opérations permettent d’éviter la perte excessive d’observations tout en conservant une cohérence structurelle entre les variables.
```{r,echo=F}
annonces <- annonces %>%
  group_by(label_eco) %>%
  mutate(
    kWh   = ifelse(is.na(kWh),   mean(kWh,   na.rm = TRUE), kWh),
    kgCO2 = ifelse(is.na(kgCO2), mean(kgCO2, na.rm = TRUE), kgCO2)
  ) %>%
  ungroup()

```

**Remplacer des valeurs manquantes dans les charges**

Certaines annonces ne précisaient pas le montant des charges.  
Plutôt qu’une suppression pure et simple, les charges manquantes ont été estimées en utilisant une méthode par **groupes de loyers** :

1. Le loyer total a été divisé en cinq intervalles (du plus faible au plus élevé).
2. Chaque logement a été associé à un groupe de loyer.
3. Les charges manquantes ont été remplacées par la moyenne observée dans leur groupe de loyers respectif.

Cette méthode permet d’imputer les charges selon un critère économique pertinent : les logements ayant 

```{r,echo=F}
# Remplacer les charges manquantes par la moyenne du groupe de loyer (arrondi à 2 décimales)
annonces <- annonces %>%
  group_by(Loyer_Groupe) %>%
  mutate(
    Charges = ifelse(
      is.na(Charges),
      round(mean(Charges, na.rm = TRUE), 2),
      Charges
    )
  ) %>%
  ungroup()

```
### c) Vérification des effectifs et cohérence interne

Les effectifs par label énergétique ont été inspectés pour vérifier la répartition des logements après nettoyage.  
Cette étape permet de s’assurer que les regroupements effectués ne créent pas de déséquilibres majeurs ou de classes trop petites.

Le travail consiste également à vérifier la cohérence logique des données, comme :

- absence de valeurs énergétiques impossibles,
- absence de surfaces irréalistes,
- cohérence entre loyer et charges.

Les observations incohérentes ont été retirées ou corrigées selon les cas.

**Vérification l'absence de valeur manquante **
```{r}
anyNA(annonces)
```

###  d) Constitution du jeu de données final
Après l’ensemble de ces traitements, la base obtenue présente les caractéristiques suivantes :

- absence de doublons,
- absence de valeurs cruciales manquantes,
- cohérence des formats (numérique, catégoriel, etc.),
- regroupement homogène des catégories énergétiques,
- estimation raisonnable des charges manquantes,
- structure compatible avec les outils de modélisation et d’analyse statistique.

Cette base nettoyée constitue le fondement de l’analyse descriptive (Section 3.3) et du modèle économétrique présenté dans la Section 4.

## 3.3 Analyse descriptive univariée des données
Cette section présente une description statistique des variables utilisées dans le modèle, après les étapes de nettoyage décrites précédemment.  
L’objectif est de caractériser la distribution de chacune des variables, d’identifier les tendances générales et de repérer d’éventuelles valeurs atypiques.  
L’analyse s’appuie sur des tableaux de statistiques descriptives ainsi que des représentations graphiques adaptées (histogrammes, boxplots, diagrammes en barres).

### a) Résumé statistique 

Les principales variables quantitatives du jeu de données sont :

- le **loyer total** (euros),
- la **surface habitable** (m²),
- les **charges mensuelles** (euros),
- le **nombre de pièces**,
- la **consommation énergétique** (kWh/an),
- les **émissions de CO₂** (kg/an).

Le tableau suivant présente les statistiques descriptives classiques : moyenne, médiane, minimum, maximum et écart-type.

```{r , echo=FALSE}
#install.packages("tidyverse")
summary_stats <- annonces %>% select(Loyer_TTC, Surface, Charges, Pièces , label_eco, kWh, kgCO2)

result <- data.frame(
  Var    = colnames(summary_stats),
  Min    = sapply(summary_stats, min, na.rm = TRUE),
  Q1     = sapply(summary_stats, quantile, 0.25, na.rm = TRUE),
  Median = sapply(summary_stats, median, na.rm = TRUE),
  Mean   = sapply(summary_stats, mean, na.rm = TRUE),
  Q3     = sapply(summary_stats, quantile, 0.75, na.rm = TRUE),
  Max    = sapply(summary_stats, max, na.rm = TRUE),
  SD     = sapply(summary_stats, sd, na.rm = TRUE)
)

knitr::kable(result, caption = "Tableau 2 : Statistiques descriptives des variables quantitatives")
```

### b) Statistiques descriptives des variables catégorielles

Les variables qualitatives retenues dans l’analyse sont :

- Le quartier du logement,

- La classe énergétique.

- Le tableau suivant présente la distribution des effectifs pour ces variables.

- Le group de loyer apres la modélisation


```{r, echo=FALSE}
library(knitr)
library(htmltools)
library(kableExtra)

# ------------------------------------------
# 0. STYLE CSS POUR BORDURE DE CHAQUE CELLULE
# ------------------------------------------
style_freqtab <- htmltools::tags$style(HTML("
table.freqtab {
  border-collapse: collapse;
  width: 100%;
}
table.freqtab th, table.freqtab td {
  border: 1px solid #bfbfbf;
  padding: 4px 6px;
}
"))

# ------------------------------------------------
# 1. TABLES DE FRÉQUENCE EN DATA.FRAME
# ------------------------------------------------
freq_quartiers <- table(annonces$Quartiers)
freq_energie   <- table(annonces$label_eco)
freq_pieces    <- table(annonces$Pièces)
freq_loyer_grp <- table(annonces$Loyer_Groupe)

# ------------------------------------------------
# 2. FONCTION : CRÉER UNE TABLE COLORÉE & BORDÉE
# ------------------------------------------------
make_table <- function(tab, title, colname){
  
  df <- as.data.frame(tab)
  names(df) <- c(colname, "Freq")  # renomme Var1
  
  kable(
    df,
    format      = "html",
    caption     = paste0("<b>", title, "</b>"),
    align       = "c",
    escape      = FALSE,
    table.attr  = 'class="freqtab"'
  ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover", "condensed"),
      full_width        = FALSE,
      font_size         = 12
    ) %>%
    as.character()
}

# ------------------------------------------------
# 3. TABLES INDIVIDUELLES AVEC NOM DE COLONNE
# ------------------------------------------------
t1 <- make_table(freq_quartiers, "Quartiers",          "Quartier")
t2 <- make_table(freq_energie,   "Classe énergétique", "Classe")
t3 <- make_table(freq_pieces,    "Nombre de pièces",   "Pièces")
t4 <- make_table(freq_loyer_grp, "Groupes de loyers",  "Groupe")

# ------------------------------------------------
# 4. AFFICHAGE HORIZONTAL AVEC CADRES COLORÉS
# ------------------------------------------------
htmltools::tagList(
  style_freqtab,   # Injection du style CSS

  htmltools::div(
    style = "display:flex; gap:20px; justify-content:space-between;",

    # --- Tableau 1 : Bleu ---
    htmltools::div(
      style="flex:1; border:3px solid #1f77b4; border-radius:8px; padding:10px; background-color:#e8f1fb;",
      HTML(t1)
    ),

    # --- Tableau 2 : Vert ---
    htmltools::div(
      style="flex:1; border:3px solid #2ca02c; border-radius:8px; padding:10px; background-color:#e8f9ec;",
      HTML(t2)
    ),

    # --- Tableau 3 : Orange ---
    htmltools::div(
      style="flex:1; border:3px solid #ff7f0e; border-radius:8px; padding:10px; background-color:#fff3e6;",
      HTML(t3)
    ),

    # --- Tableau 4 : Rouge ---
    htmltools::div(
      style="flex:1; border:3px solid #d62728; border-radius:8px; padding:10px; background-color:#fde8ea;",
      HTML(t4)
    )
  )
)


```

**Interprétation ** :

Les quatre tableaux obtenus après les étapes de nettoyage permettent d’apprécier la structure du jeu de données final. De manière générale, ils montrent que la base est désormais cohérente, équilibrée et prête pour l’analyse statistique.

- **Répartition géographique**  
  La distribution des logements entre les quatre secteurs de Rennes (Centre, Nord-Est, Nord-Ouest et Ouest) est relativement homogène.  
  Aucun quartier n’est surreprésenté, ce qui garantit une analyse territoriale équilibrée et évite un biais lié à la localisation.

- **Performance énergétique**  
  Après la suppression des logements non classés (NC) et le regroupement des classes rares, les performances énergétiques se répartissent de manière équilibrée entre trois catégories principales (C+, D et E−).  
  Cette restructuration permet d’obtenir des effectifs suffisants dans chaque classe pour une analyse économétrique fiable.

- **Nombre de pièces**  
  La majorité des annonces concernent des logements d’une pièce, ce qui est cohérent avec la forte présence étudiante à Rennes.  
  Toutefois, les logements de deux à cinq pièces restent suffisamment représentés pour évaluer leur impact sur les variations de loyer.

- **Groupes de loyers**  
  La découpe des loyers en intervalles fournit des groupes de taille comparable, reflétant un marché locatif diversifié allant des petits logements économiques aux biens plus spacieux et onéreux.  
  Cette structuration facilite les comparaisons et sert également de base à certaines imputations, notamment pour le montant des charges.
### c)  Graphique des principales variables

L’histogramme permet de visualiser la distribution des variables quantitatives.
Les graphiques suivants représentent :



```{r}
library(ggplot2)
library(gridExtra)
#On peut aussi regarder les boxplots pour chaque variable pour avoir une idée rapide des quartiles.

graphConso.bp <- function(uneVariable){
  ggplot(data = annonces, aes_string(x = "factor(0)", y = uneVariable)) +
    geom_boxplot() + xlab("")
}
p1.bp <- graphConso.bp("Surface")
p2.bp <- graphConso.bp("Charges")
p3.bp <- graphConso.bp("Pièces")
p4.bp <- graphConso.bp("label_eco")
p5.bp <- graphConso.bp("kWh")
p6.bp <- graphConso.bp("kgCO2")



grid.arrange(p1.bp, p2.bp, p3.bp, p4.bp, p5.bp, p6.bp, ncol = 2)


```



#### La distribution des surfaces selon le groupe de loyer


**Commentaire :**  
On observe que la surface tend globalement à augmenter avec le groupe de loyer.  
Les logements appartenant au groupe de loyers le plus faible présentent les surfaces les plus réduites, souvent inférieures à 25 m².  
À l’inverse, les groupes de loyers les plus élevés se caractérisent par des surfaces plus importantes, bien que la variabilité demeure élevée.

La présence de valeurs extrêmes dans les groupes intermédiaires suggère que le loyer n’est pas seulement déterminé par la surface mais également par d’autres facteurs tels que la localisation, la qualité du logement ou la performance énergétique.

Cette analyse confirme toutefois une tendance générale : **les logements plus grands sont associés à des niveaux de loyer plus élevés**, ce qui est cohérent avec les mécanismes du marché locatif.

#### La distribution des charges 

**Commentaire : Analyse du nuage de points Charges – Loyer**

 **Relation globalement croissante**  
   On observe une tendance générale à la hausse : lorsque les charges augmentent, le loyer total tend également à augmenter.  
   Cela est cohérent avec le fonctionnement du marché locatif :  
   - les logements plus grands ou mieux équipés ont généralement des charges plus élevées (eau, chauffage collectif, ascenseur, copropriété),  
   - et un loyer total plus important.

 **Dispersion importante pour les faibles charges**  
   Pour des charges comprises entre 0 et 80 euros, les loyers apparaissent très dispersés (de 350 € à plus de 1500 €).  
   Cela s’explique par le fait que deux logements ayant de faibles charges peuvent différer fortement en surface, en localisation ou en standing.  
   Ainsi, les charges ne suffisent pas à elles seules pour expliquer le montant du loyer.

 **Présence de quelques valeurs extrêmes**  
   Quelques observations présentent des charges très élevées (200 à 300 €), associées à des loyers supérieurs à 1500 €.  
   Ces cas correspondent probablement à :  
   - des appartements de grande taille,  
   - des résidences récentes ou disposant de services inclus,  
   - ou des logements haut de gamme.  
   Ces valeurs extrêmes restent peu nombreuses mais économiquement cohérentes.

 **Relation non linéaire et corrélation modérée**  
   La dispersion du nuage montre que les charges ne permettent pas à elles seules de prédire précisément le loyer.  
   La relation est positive mais relativement faible.  
   Cela suggère que d’autres variables jouent un rôle déterminant : la surface, le quartier, la classe énergétique, le nombre de pièces, etc.  
   Ceci justifie la mise en place d’un modèle de régression multiple intégrant plusieurs caractéristiques du logement.

#### La distribution du prix de Loyer selon les facteurs.
```{r,,echo=F}
selon_quartier <-ggplot(annonces, aes(x = Quartiers, y = Loyer_TTC)) +
  geom_boxplot(fill = "orange", color = "black") +
  labs(
    title = "Distribution du prix du loyer selon quartiers",
    x = "Nom de quartiers ",
    y = "Loyer TCC (euros)"
  ) +
  theme_minimal()

selon_nbpcs <-ggplot(annonces, aes(x = factor(Pièces), y = Loyer_TTC)) +
  geom_boxplot(fill = "lightgreen", color = "black") +
  labs(
    title = "Distribution du prix du loyer selon le nombre de pièces",
    x = "Nombre de pièces",
    y = "Loyer TCC (euros)"
  ) +
  theme_minimal()
selon_label <-ggplot(annonces, aes(x = factor(label_eco), y = Loyer_TTC)) +
  geom_boxplot(fill = "lightgreen", color = "black") +
  labs(
    title = "Distribution du prix du loyer selon le nombre de pièces",
    x = "Classe d'énergitique",
    y = "Loyer TCC (euros)"
  ) +
  theme_minimal()
grid.arrange(selon_quartier , selon_label , selon_nbpcs, ncol = 2)
```
**Commentaire : Analyse du loyer selon le nombre de pièces**

 **Hausse nette du loyer avec le nombre de pièces**  
   Le boxplot montre une relation clairement croissante :  
   plus le logement comporte de pièces, plus le loyer tout compris augmente.  
   Cette tendance est attendue, car les appartements plus spacieux nécessitent un loyer plus élevé.

 **Progression marquée entre chaque catégorie**  
   À chaque passage d’une catégorie de pièces à la suivante (1 → 2, 2 → 3, etc.),  
   la médiane du loyer augmente significativement.  
   Cela confirme que le nombre de pièces constitue un déterminant majeur du niveau de loyer.

 **Dispersion croissante pour les grands logements**  
   Les logements de 3 pièces et plus présentent une plus grande variabilité de prix :  
   - les biens peuvent varier fortement en surface,  
   - en standing,  
   - ou en localisation.  
   Cette diversité se traduit par des écarts-types plus élevés et quelques valeurs extrêmes, notamment pour les 4 pièces.

 **Présence d’outliers chez les petits et grands logements**  
   - Quelques studios (1 pièce) affichent des loyers anormalement élevés, probablement liés à une localisation très centrale ou à des logements meublés haut de gamme.  
   - À l’inverse, certains logements de 4 pièces présentent des loyers exceptionnellement hauts (plus de 2000 €), cohérents avec des biens très spacieux ou haut standing.

 **Conclusion générale**  
   Le graphique confirme que **le nombre de pièces est un facteur explicatif déterminant du loyer**.  
   Il influence à la fois le niveau central du loyer (médiane) et sa dispersion.  
   Ce constat justifie l’intégration de cette variable dans la régression linéaire comme variable explicative structurante.

#### La distribution du prix de Loyer selon quartiers

**Analyse du loyer selon les différents quartiers de Rennes**

   **Quartiers Centre : les loyers les plus élevés**  
   Le quartier Centre présente les niveaux de loyer les plus hauts de l’échantillon.  
   La médiane y dépasse nettement celle des autres secteurs, et la dispersion est importante.  
   Cette variabilité reflète la diversité de l’offre dans l’hypercentre (studios chers, logements rénovés, petites surfaces premium).

  **Quartier Nord-Est : le secteur le plus abordable**  
   Le Nord-Est affiche les loyers les plus faibles, avec une médiane sensiblement inférieure à celles des autres quartiers.  
   Ce secteur regroupe majoritairement des logements plus petits et plus accessibles, ce qui explique son positionnement plus bas dans la distribution.

  **Quartier Nord-Ouest : un niveau intermédiaire mais dispersé**  
   Le Nord-Ouest présente une médiane de loyer proche de celle du Centre, tout en restant légèrement inférieure.  
   La dispersion est cependant importante, signe d’une grande hétérogénéité du parc locatif (logements étudiants, maisons familiales, rénovations récentes).

  **Quartier Ouest : des loyers modérés mais plus variés**  
   Le quartier Ouest se situe dans une position intermédiaire, avec une médiane plus élevée que celle du Nord-Est mais inférieure à celle du Centre et du Nord-Ouest.  
   Une dispersion notable indique la coexistence de logements modestes et de biens plus spacieux ou récents.


## 3.4 Analyse descriptive bivariée des données 
### Corrélation
#### 1ère règle: Coefficient de Corrélation
```{r}
library(corrplot)
vars_quanti <- annonces %>% select(-c(Quartiers , Loyer_Groupe))
corrplot(cor(vars_quanti), method="circle")
corrplot(cor(vars_quanti), method="number")

```
**Commentaire : Corrélations entre le loyer et les variables explicatives**

Le tableau met en évidence plusieurs relations importantes entre la variable expliquée (*Loyer_TTC*) et les variables explicatives quantitatives :

1. **Surface (corr = 0.93)**  
   C’est la corrélation la plus forte observée.  
   Le loyer augmente très fortement avec la surface du logement.  
   Cette relation quasi linéaire confirme que la surface est le principal déterminant du prix.

2. **Nombre de pièces (corr = 0.87)**  
   Le nombre de pièces est également fortement corrélé au loyer.  
   Cela s’explique naturellement par le fait qu’un logement comportant plus de pièces possède généralement une surface plus importante et un niveau de confort supérieur.

3. **Charges (corr = 0.61)**  
   Une corrélation positive modérée :  
   les logements ayant des charges plus élevées ont souvent des loyers plus élevés.  
   Cependant, la relation est moins forte que pour la surface et les pièces.

4. **Consommation énergétique kWh (corr = –0.30)**  
   La corrélation est faible et négative.  
   Cela suggère que les logements très énergivores (kWh élevés) ont tendance à être légèrement moins chers, ce qui est cohérent avec l’idée qu’un mauvais bilan énergétique peut réduire la valeur locative.

5. **Émissions de CO₂ (corr = 0.21)**  
   Corrélation faible et positive.  
   Cela signifie qu’il n’existe pas de relation claire entre les émissions de CO₂ et le montant du loyer.  
   Le CO₂ est probablement un facteur indirect qui reflète davantage la performance énergétique ou la taille du logement.


Si la valeur absolue du coefficient de corrélation entre deux variables excède 0.8, on peut soupçonner la colinéarité.



Selon cette règle, on peut soupçonner un problème de colinéarité entre les variables vol et surface, ainsi que pers et surface.

#### Deuxième règle (règle de Klein)
```{r}
reg_simple <- lm(Loyer_TTC ~ Surface + Charges + Pièces + label_eco + kWh + kgCO2 + Quartiers_Centre + Quartiers_Nord_Est + Quartiers_Nord_Ouest + Quartiers_Ouest , data = annonces)
summary(reg_simple)
```
Quartiers_Ouest est une combinaison linéaire des autres (colinéarité parfaite) → elle ne peut pas être estimée → d’où NA.

En supprimant la modalité, vous obtenez un modèle propre, cohérent et sans singularités.


Si le carré du coefficient de corrélation est supérieur au R^2, on peut soupçonner de la colinéarité.

```{r}
#cor(vars_quanti)^2 > summary(reg)$r.squared
```
Cette règle met en avant un éventuel problème de colinéarité entre les variables vol et surface.

#### Troisième règle : cohérence des signes

Le signe de la correlation brute et celui de la correlation expliquée devraient être les memes.
```{r}
#cbind(coef = reg$coef, corr = cor(df)[,"kw"])[-1,]
```

Il y a manifestement des contre-sens concernant les relations entre le nombre de personne et la consommation, ainsi que le nombre de salles de bain et la consommation.

#### colinéarités : VIF

```{r}
library(car)

#vif(reg)

#commentaires
#sqrt(vif(reg))
```






### b) Nuage de point vis à vis de Y
```{r, warning=FALSE, message=FALSE}

graphConso <- function(uneVariable){
  ggplot(data = annonces, aes_string(x = uneVariable, y = "Loyer_TTC")) + geom_point() + geom_smooth()
}

p1 <- graphConso("Surface")
p2 <- graphConso("Charges")
p3 <- graphConso("Pièces")
p4 <- graphConso("label_eco")
p5 <- graphConso("kWh")
p6 <- graphConso("kgCO2")

p7 <-graphConso("Quartiers_Centre")
p8 <-graphConso("Quartiers_Nord_Est")
p9 <-graphConso("Quartiers_Nord_Ouest")
p10 <-graphConso("Quartiers_Ouest")

grid.arrange(p1, p2, p3, p4, p5, p6 , p7,p8,p9,p10, ncol = 3)




```

## Analyse graphique de la relation entre le loyer et les variables explicatives

L’observation des nuages de points permet d’étudier la nature de la relation entre le loyer toutes charges comprises (**Loyer\_TTC**) et les différentes variables explicatives disponibles dans la base de données.  
Les courbes de lissage (LOESS) permettent d’identifier si la relation semble linéaire, croissante, décroissante ou non linéaire.

Les conclusions suivantes peuvent être formulées :

### **Surface**
La relation entre la surface et le loyer apparaît clairement **croissante et linéaire**.  
On peut donc modéliser cette relation par une forme linéaire simple :
\[
Loyer\_{TTC} = \beta_0 + \beta_1 \cdot Surface
\]

### **Charges**
La relation entre les charges et le loyer présente une légère **courbure**, suggérant une relation **quadratique** :
\[
Loyer\_{TTC} = \beta_0 + \beta_1 \cdot Charges + \beta_2 \cdot Charges^2
\]

### **Nombre de pièces**
La relation est **croissante et linéaire**, sans signe de non-linéarité :
\[
Loyer\_{TTC} = \beta_0 + \beta_1 \cdot Pièces
\]

### **Classe énergétique (label_eco)**
La variable *label_eco* est qualitative : les points se répartissent en bandes verticales.  
Aucune tendance fonctionnelle continue ne peut être modélisée.  
Elle doit être introduite dans le modèle sous forme de **variable factorielle** :
\[
Loyer\_{TTC} = \beta_0 + \sum_i \beta_i \cdot \mathbf{1}\{label\_eco = i\}
\]

### **Consommation énergétique (kWh)**
La courbe montre une légère forme en « U ».  
La relation peut donc être modélisée par une fonction **quadratique** :
\[
Loyer\_{TTC} = \beta_0 + \beta_1 \cdot kWh + \beta_2 \cdot kWh^2
\]

### **Émissions de CO2 (kgCO2)**
Même comportement que pour kWh, avec une légère convexité :
\[
Loyer\_{TTC} = \beta_0 + \beta_1 \cdot kgCO2 + \beta_2 \cdot kgCO2^2
\]

### **Variables géographiques (Centre, Nord_Est, Nord_Ouest, Ouest)**
Ces variables sont binaires (0/1).  
Elles n’induisent pas de forme fonctionnelle mais représentent un **effet de présence** du quartier correspondant :
\[
Loyer\_{TTC} = \beta_0 + \beta_1 \cdot Quartier\_dummy
\]

---



### c) Corrélations entre les variables explicatives
L’analyse de la matrice de corrélation entre les variables explicatives permet de détecter
d’éventuels problèmes de multicolinéarité dans le futur modèle de régression.

1. **Surface et nombre de pièces (corr = 0.94)**  
   Il s’agit de la corrélation la plus élevée entre les variables explicatives.  
   Cela s’explique par le fait que les logements comportant davantage de pièces
   sont presque toujours plus grands.  
   Cette corrélation très forte peut poser un risque de multicolinéarité dans la régression.
   Le modèle devra en tenir compte, par exemple en n’interprétant pas séparément
   ces deux variables ou en examinant les VIF.

2. **Surface et Charges (corr = 0.61)**  
   Les logements plus grands ont en général des charges plus élevées (chauffage collectif,
   copropriété, entretien).  
   La corrélation est modérée mais non problématique.

3. **Pièces et Charges (corr = 0.54)**  
   Les appartements ayant plus de pièces entraînent généralement plus de charges.  
   Cette corrélation reste raisonnable et ne conduit pas à une multicolinéarité forte.

4. **Variables énergétiques (kWh, CO₂)**  
   - kWh présente de faibles corrélations avec les autres variables (entre −0.30 et −0.20).  
   - kgCO₂ montre également des corrélations faibles (entre 0.18 et 0.25).  

   Ces valeurs indiquent que la performance énergétique évolue de manière
   relativement indépendante des autres caractéristiques du logement.
   Il n’existe donc pas de risque de multicolinéarité majeure provenant des variables énergétiques.

5. **Absence de corrélations problématiques en dehors de Surface–Pièces**  
   Globalement, toutes les corrélations sont faibles ou modérées,
   à l’exception du couple Surface–Pièces, qui présente une colinéarité naturellement élevée
   mais interprétable.



**Conclusion :**  
La seule multicolinéarité forte concerne *Surface* et *Pièces*.  
Cela devra être vérifié lors de l’estimation du modèle (par les VIF),
mais les autres variables explicatives sont suffisamment indépendantes
pour être intégrées sans risque dans la régression linéaire.

# **4. Analyse et discussion des résultats**

## 4.1 Modélisation principale

Présentation et interprétation des résultats obtenus : utiliser un tableau récapitulatif des modèles principaux testés

stepAIC() choisit le meilleur par AIC. En option on peut choisir la direction:

i) “both” (for stepwise regression, both forward and backward selection); 
ii) “backward” (for backward selection)
iii) “forward” (for forward selection).

En fonction de la procédure nous pouvons obtenir une sélection de variables différentes

```{r}
library(MASS)

# estimation du modèle complet 
full.model <- lm(Loyer_TTC ~., data = annonces_regression)

# Backward regression model
step.model_backward <- stepAIC(full.model, direction = "backward", 
                      trace = FALSE)
summary(step.model_backward)

# forward regression model
step.model_forward <- stepAIC(full.model, direction = "forward", 
                      trace = FALSE)
summary(step.model_forward)

# Stepwise regression model
step.model_both <- stepAIC(full.model, direction = "both", 
                      trace = FALSE)
summary(step.model_both)
```

### model complexe selon la graphiqiue choisie par les méthodes Backward forwardStepwise
```{r}
# estimation du modèle complet 
full.model <- lm(Loyer_TTC ~  Surface +Charges + Charges**2 + Pièces + label_eco + label_eco**2+
    kWh +kWh**2 + kgCO2 + kgCO2**2 + Quartiers_Centre + `Quartiers_Nord_Est` + `Quartiers_Nord_Ouest` + 
    Quartiers_Ouest , data = annonces_regression)

# Backward regression model
step.model_backward <- stepAIC(full.model, direction = "backward", 
                      trace = FALSE)
summary(step.model_backward)

# forward regression model
step.model_forward <- stepAIC(full.model, direction = "forward", 
                      trace = FALSE)
summary(step.model_forward)

# Stepwise regression model
step.model_both <- stepAIC(full.model, direction = "both", 
                      trace = FALSE)
summary(step.model_both)
```



```{r}
# Modèle 1: Linéaire simple avec toutes les variables
modele1 <- lm(Loyer_TTC ~ Surface + Charges + Pièces + 
                label_eco + kWh + kgCO2 +
                Quartiers_Centre + Quartiers_Nord_Est + 
                Quartiers_Nord_Ouest , 
              data = annonces)

# Modèle 2: Avec transformation logarithmique pour Surface et Loyer
modele2 <- lm(log(Loyer_TTC) ~ log(Surface) + Charges + Pièces + 
                label_eco + kWh + kgCO2 +
                Quartiers_Centre + Quartiers_Nord_Est + 
                Quartiers_Nord_Ouest , 
              data = annonces)
# Modèle 3: Avec termes quadratiques pour Charges, kWh, kgCO2
modele3 <- lm(Loyer_TTC ~ Surface + Charges + I(Charges^2) + Pièces + 
                label_eco + kWh + I(kWh^2) + kgCO2 + I(kgCO2^2) +
                Quartiers_Centre + Quartiers_Nord_Est + 
                Quartiers_Nord_Ouest, 
              data = annonces)

# Modèle 4: Sans Surface (pour éviter colinéarité avec Pièces)
modele4 <- lm(Loyer_TTC ~ Pièces + Charges + 
                as.factor(label_eco) + kWh + kgCO2 +
                Quartiers_Centre + Quartiers_Nord_Est + 
                Quartiers_Nord_Ouest , 
              data = annonces)
# Liste des modèles
models <- list(modele1 = modele1,
               modele2 = modele2,
               modele3 = modele3,
               modele4 = modele4)

# Fonction pour extraire les stats utiles
extract_stats <- function(m) {
  s <- summary(m)
  data.frame(
    R2        = round(s$r.squared, 4),
    Adj_R2    = round(s$adj.r.squared, 4),
    AIC       = round(AIC(m), 1),
    BIC       = round(BIC(m), 1),
    Resid_SE  = round(s$sigma, 3)
  )
}

# Création du tableau récapitulatif
result_models <- do.call(rbind, lapply(models, extract_stats))
result_models



```


## 4.2 Robustesse des résultats 

Hypothèses des MCO - nomalités / hétéroscédasticité / ...

## 4.2 Analyses complémentaires  

-   Transformation de variables / effets non linéaires

-   Changement structurel

-   Effets croisés de variables

# **5. Conclusion générale et perspectives**

Rappel de la problématique et de la méthodologie

Synthèse des résultats principaux

Contributions du mémoire, apports scientifiques et/ou applicatifs

Perspectives d’amélioration ou de recherche future

# Bibliographie - Source des données



---

---





